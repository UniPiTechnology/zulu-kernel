// SPDX-License-Identifier: (GPL-3.0+ OR MIT)
/*
 * Copyright 2020 Faster CZ
 * Copyright 2019 NXP
 */

/dts-v1/;

#include <dt-bindings/usb/pd.h>
#include "unipi-zulu.dtsi"

/ {
	model = "Unipi Zulu (Unipi Zulu, i.MX8MM)";

	unipi_id: unipi-id {
        compatible = "unipi,unipi-id";
        nvmem = <&unipi_mb>;
        nvmem-names = "plcid0";
        id-channel = <&i2c3>;
    };

	mbleds {
	    compatible = "gpio-leds";

		user-led@1 {
	        label = "unipi-sysled-xhr";
	        gpios = <&gpio_mb 2 GPIO_ACTIVE_LOW>;
	        default-state = "off";
	    };

	    user-led@2 {
	        label = "unipi-sysled-xhb";
	        gpios = <&gpio_mb 3 GPIO_ACTIVE_LOW>;
		    #default-state = "off";
		    default-state = "on";
	        linux,default-trigger = "none";
	    };

	    user-led@3 {
	        label = "unipi-sysled-xhg";
	        gpios = <&gpio_mb 4 GPIO_ACTIVE_LOW>;
		    default-state = "off";

	    };

	    user-led@4 {
	        label = "unipi-sysled-rx";
	        gpios = <&gpio_mb 6 GPIO_ACTIVE_LOW>;
	        default-state = "off";
	    };

	    user-led@5 {
	        label = "unipi-sysled-tx";
	        gpios = <&gpio_mb 7 GPIO_ACTIVE_LOW>;
	        default-state = "off";
	    };
	};
};
                    
&uart3 { /* console */
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart3>, <&pinctrl_uart3_ctrl>;
	linux,rs485-enabled-at-boot-time;
	rts-gpios = <&gpio4 27 GPIO_ACTIVE_HIGH>;
	status = "okay";
};

&i2c3 {
    status = "okay";

    unipi_mb:24c01@57 {
        compatible = "atmel,24c01";
        reg = <0x57>;
        status = "okay";
    };

    rtc@6f {
            compatible = "microchip,mcp7941x";
            reg = <0x6f>;
    };

    gpio_mb: pcf8574@20 {
          compatible = "nxp,pcf8574";
          gpio-controller;
          #gpio-cells = <2>;
          reg = <0x20>;
    };

};

&ecspi3 {
    fsl,spi-num-chipselects = <0>;
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_ecspi3>, <&pinctrl_ecspi3_cs>;
    cs-gpios = <&gpio5 25 1>;
    status = "okay";

    unipispi0: unipispi@0 {
        compatible = "unipispi";
        reg = <0>;
        status = "okay";
        spi-max-frequency = <12000000>;
        neuron-board-index = <0>;
        modbus-address = <1>;
        neuron-probe-always-succeeds = <0>;
        #address-cells = <1>;
        #size-cells = <0>;
        iogroup1 {
            reg = <1>;
            pinctrl-names = "default";
            compatible = "unipi,unipi-mfd", "iogroup";
            fw_variant = <0x0010>, <0x0020>, <0x0030>, <0x0110>;
            fw_name = "B-1000-1", "B-1000-2", "B-1000-3", "E-8Di8Ro-1";
            board_name = "B-1000-1", "E-8Di8Ro-1";
            sys_board_name = "B_1000/E_8Di8Ro";
         };
    };
};

&iomuxc {

    pinctrl_ecspi3_cs: ecspi3cs {
            fsl,pins = <
                MX8MM_IOMUXC_UART2_TXD_GPIO5_IO25           0x16
            >;
    };
};

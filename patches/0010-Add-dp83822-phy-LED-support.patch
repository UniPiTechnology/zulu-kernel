From 82e7ae002d6e6e921cef7b4cf135a48b7c8b6c21 Mon Sep 17 00:00:00 2001
From: Miroslav Ondra <ondra@faster.cz>
Date: Thu, 10 Mar 2022 19:03:56 +0100
Subject: [PATCH 10/12] Add dp83822 phy LED support

---
 drivers/net/phy/dp83822.c | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/drivers/net/phy/dp83822.c b/drivers/net/phy/dp83822.c
index 211b5476a..91050585c 100644
--- a/drivers/net/phy/dp83822.c
+++ b/drivers/net/phy/dp83822.c
@@ -31,6 +31,7 @@
 #define MII_DP83822_FCSCR	0x14
 #define MII_DP83822_RCSR	0x17
 #define MII_DP83822_RESET_CTRL	0x1f
+#define MII_DP83822_MLEDCR	0x25
 #define MII_DP83822_GENCFG	0x465
 #define MII_DP83822_SOR1	0x467
 
@@ -465,11 +466,21 @@ static int dp83822_config_init(struct phy_device *phydev)
 				return err;
 		}
 	}
+#define MLED_ROUTED_LED_0	0x3
+#define MLED_MOD_LINK_OK	0x0
+#define MLED_MOD_RX_TX		0x1
+#define MLED_MOD_LINK_ACT	0x8
+
+#define MLED_MOD_SHIFT	3
+
+	phy_set_bits_mmd(phydev, DP83822_DEVADDR, MII_DP83822_MLEDCR, MLED_ROUTED_LED_0 | (MLED_MOD_RX_TX<<MLED_MOD_SHIFT));
+
 	return dp8382x_disable_wol(phydev);
 }
 
 static int dp8382x_config_init(struct phy_device *phydev)
 {
+	phy_write(phydev, 0x25, 0x43);
 	return dp8382x_disable_wol(phydev);
 }
 
-- 
2.20.1


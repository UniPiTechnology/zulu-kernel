From 28acb880411469cfbaeffb5b8a21c0e93ffb0996 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Martin=20T=C5=99=C3=ADska?= <triska@unipi.technology>
Date: Fri, 29 Apr 2022 07:16:04 +0000
Subject: [PATCH 11/12] Changed PHY MLED behavior to mode LINK ON / BLINK on
 TX/RX Activity

---
 drivers/net/phy/dp83822.c | 17 +++++++++--------
 1 file changed, 9 insertions(+), 8 deletions(-)

diff --git a/drivers/net/phy/dp83822.c b/drivers/net/phy/dp83822.c
index 91050585c..a3d990baf 100644
--- a/drivers/net/phy/dp83822.c
+++ b/drivers/net/phy/dp83822.c
@@ -377,6 +377,13 @@ static int dp83822_read_status(struct phy_device *phydev)
 	return 0;
 }
 
+#define MLED_ROUTED_LED_0	0x3
+#define MLED_MOD_LINK_OK	0x0
+#define MLED_MOD_RX_TX		0x1
+#define MLED_MOD_LINK_ACT	0x8
+
+#define MLED_MOD_SHIFT	3
+
 static int dp83822_config_init(struct phy_device *phydev)
 {
 	struct dp83822_private *dp83822 = phydev->priv;
@@ -466,21 +473,15 @@ static int dp83822_config_init(struct phy_device *phydev)
 				return err;
 		}
 	}
-#define MLED_ROUTED_LED_0	0x3
-#define MLED_MOD_LINK_OK	0x0
-#define MLED_MOD_RX_TX		0x1
-#define MLED_MOD_LINK_ACT	0x8
-
-#define MLED_MOD_SHIFT	3
 
-	phy_set_bits_mmd(phydev, DP83822_DEVADDR, MII_DP83822_MLEDCR, MLED_ROUTED_LED_0 | (MLED_MOD_RX_TX<<MLED_MOD_SHIFT));
+	phy_set_bits_mmd(phydev, DP83822_DEVADDR, MII_DP83822_MLEDCR, MLED_ROUTED_LED_0 | (MLED_MOD_LINK_ACT<<MLED_MOD_SHIFT));
 
 	return dp8382x_disable_wol(phydev);
 }
 
 static int dp8382x_config_init(struct phy_device *phydev)
 {
-	phy_write(phydev, 0x25, 0x43);
+	phy_write(phydev, MII_DP83822_MLEDCR, MLED_ROUTED_LED_0 | (MLED_MOD_LINK_ACT<<MLED_MOD_SHIFT));
 	return dp8382x_disable_wol(phydev);
 }
 
-- 
2.20.1

